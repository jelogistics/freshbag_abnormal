<!DOCTYPE html>
<html lang="ko">
<head>

<meta charset="UTF-8">
<title>프레시백 미회수 검수 사진 확인</title>

<style>
    body {
        font-family: sans-serif;
        max-width: 800px;
        margin: auto;
        padding: 20px;
    }
    form {
        background-color: #f9f9f9;
        padding: 15px;
        border-radius: 10px;
        margin-bottom: 20px;
    }
    input, select, button {
        margin: 5px;
        padding: 8px;
        font-size: 16px;
    }
    #result div {
        background-color: #f0f0f0;
        padding: 15px;
        margin-bottom: 20px;
        border-radius: 8px;
    }
    img {
        max-width: 100%;
        height: auto;
        border-radius: 5px;
    }
    .big-image {
        width: 1257px;
        height: auto;
        display: block;
        margin-top: 10px;
        border-radius: 5px;
    }
</style>

</head>
<body>

<div style="text-align: center; margin-bottom: 20px;">
    <img src="logo.png" alt="회사 로고" style="max-width: 500px; height: auto;">
</div>

<h1>프레시백 미회수 검수 사진 확인</h1>

<form id="searchForm">
    <label for="workType">업무형태:</label>
    <select id="workType">
        <option value="">선택하세요</option>
        <option value="주간">주간</option>
        <option value="야간">야간</option>
    </select>

    <label for="camp">캠프:</label>
    <select id="camp">
        <option value="">선택하세요</option>
        <option value="강서1캠프">강서1캠프</option>
        <option value="광주1캠프">광주1캠프</option>
        <option value="광주2캠프">광주2캠프</option>
        <option value="구로1캠프">구로1캠프</option>
        <option value="구리1캠프">구리1캠프</option>
        <option value="구리2캠프">구리2캠프</option>
        <option value="구리3캠프">구리3캠프</option>
        <option value="구미1캠프">구미1캠프</option>
        <option value="군포1캠프">군포1캠프</option>
        <option value="김포1캠프">김포1캠프</option>
        <option value="김해1캠프">김해1캠프</option>
        <option value="김해2캠프">김해2캠프</option>
        <option value="남양주1캠프">남양주1캠프</option>
        <option value="남양주2캠프">남양주2캠프</option>
        <option value="남양주3캠프">남양주3캠프</option>
        <option value="남양주4캠프">남양주4캠프</option>
        <option value="대구1캠프">대구1캠프</option>
        <option value="대구2캠프">대구2캠프</option>
        <option value="대구3캠프">대구3캠프</option>
        <option value="대구4캠프">대구4캠프</option>
        <option value="대구5캠프">대구5캠프</option>
        <option value="대전1캠프">대전1캠프</option>
        <option value="대전2캠프">대전2캠프</option>
        <option value="대전3캠프">대전3캠프</option>
        <option value="동탄1캠프">동탄1캠프</option>
        <option value="동탄2캠프">동탄2캠프</option>
        <option value="부산1캠프">부산1캠프</option>
        <option value="부산2캠프">부산2캠프</option>
        <option value="부산3캠프">부산3캠프</option>
        <option value="부산4캠프">부산4캠프</option>
        <option value="부산5캠프">부산5캠프</option>
        <option value="서초1캠프">서초1캠프</option>
        <option value="성동1캠프">성동1캠프</option>
        <option value="송파1캠프">송파1캠프</option>
        <option value="송파2캠프">송파2캠프</option>
        <option value="송파3캠프">송파3캠프</option>
        <option value="송파4캠프">송파4캠프</option>
        <option value="송파5캠프">송파5캠프</option>
        <option value="수원1캠프">수원1캠프</option>
        <option value="시흥1캠프">시흥1캠프</option>
        <option value="시흥2캠프">시흥2캠프</option>
        <option value="안산1캠프">안산1캠프</option>
        <option value="안산2캠프">안산2캠프</option>
        <option value="안양1캠프">안양1캠프</option>
        <option value="양주1캠프">양주1캠프</option>
        <option value="양주2캠프">양주2캠프</option>
        <option value="양주3캠프">양주3캠프</option>
        <option value="용인1캠프">용인1캠프</option>
        <option value="용인2캠프">용인2캠프</option>
        <option value="용인3캠프">용인3캠프</option>
        <option value="울산1캠프">울산1캠프</option>
        <option value="울산2캠프">울산2캠프</option>
        <option value="인천1캠프">인천1캠프</option>
        <option value="인천2캠프">인천2캠프</option>
        <option value="인천3캠프">인천3캠프</option>
        <option value="인천4캠프">인천4캠프</option>
        <option value="인천5캠프">인천5캠프</option>
        <option value="인천6캠프">인천6캠프</option>
        <option value="인천7캠프">인천7캠프</option>
        <option value="인천8캠프">인천8캠프</option>
        <option value="일산1캠프">일산1캠프</option>
        <option value="일산2캠프">일산2캠프</option>
        <option value="일산3캠프">일산3캠프</option>
        <option value="일산4캠프">일산4캠프</option>
        <option value="일산5캠프">일산5캠프</option>
        <option value="일산6캠프">일산6캠프</option>
        <option value="일산7캠프">일산7캠프</option>
        <option value="일산8캠프">일산8캠프</option>
        <option value="전주1캠프">전주1캠프</option>
        <option value="제주1캠프">제주1캠프</option>
        <option value="제주2캠프">제주2캠프</option>
        <option value="제주3캠프">제주3캠프</option>
        <option value="중구1캠프">중구1캠프</option>
        <option value="창원1캠프">창원1캠프</option>
        <option value="천안1캠프">천안1캠프</option>
        <option value="청주1캠프">청주1캠프</option>
        <option value="화성1캠프">화성1캠프</option>
    </select>

    <label for="route">라우트:</label>
    <input type="text" id="route" placeholder="라우트 입력">

    <button type="button" onclick="search()">검색</button>
</form>

<hr>

<div id="result"></div>

<script>
let data = [];

fetch('data_updated.json')
    .then(response => response.json())
    .then(json => {
        data = json;
    })
    .catch(error => {
        console.error("데이터 불러오기 실패:", error);
    });

function search() {
    const workType = document.getElementById('workType').value;
    const camp = document.getElementById('camp').value;
    const route = document.getElementById('route').value.trim();

    const filtered = data.filter(item => 
        (workType === "" || item.workType === workType) &&
        (camp === "" || item.camp === camp) &&
        (route === "" || item.route.includes(route))
    );

    const resultDiv = document.getElementById('result');
    resultDiv.innerHTML = "";

    if (filtered.length === 0) {
        resultDiv.innerHTML = "<p>검색 결과가 없습니다.</p>";
        return;
    }

    filtered.forEach((item, index) => {
        const entry = document.createElement('div');
        entry.innerHTML = `
            <input type="checkbox" id="check_${index}" onchange="toggleReason(${index})">
            <label for="check_${index}"><strong>${item.date} | ${item.workType} | ${item.camp} | ${item.route}</strong></label>
            <br>
            <img src="${item.photo}" alt="사진" class="big-image">
            <div id="reason_${index}" style="display:none; margin-top:10px;">
                <textarea placeholder="이의제기 사유 입력" rows="3" style="width:100%;"></textarea>
            </div>
            <hr>
        `;
        resultDiv.appendChild(entry);
    });

    // 제출 버튼 추가
    const submitButton = document.createElement('button');
    submitButton.textContent = "이의제기 제출";
    submitButton.onclick = submitObjection;
    submitButton.style.marginTop = "20px";
    resultDiv.appendChild(submitButton);
}

function toggleReason(index) {
    const checkbox = document.getElementById(`check_${index}`);
    const reasonDiv = document.getElementById(`reason_${index}`);
    reasonDiv.style.display = checkbox.checked ? "block" : "none";
}

function submitObjection() {
    const objections = [];

    const checkboxes = document.querySelectorAll('input[type="checkbox"]');
    checkboxes.forEach((checkbox, index) => {
        if (checkbox.checked) {
            const reason = document.querySelector(`#reason_${index} textarea`).value.trim();
            const label = checkbox.nextElementSibling.textContent.split('|').map(item => item.trim());
            objections.push({
                date: label[0],
                workType: label[1],
                camp: label[2],
                route: label[3],
                reason: reason
            });
        }
    });

    if (objections.length === 0) {
        alert("이의제기할 항목을 선택해주세요!");
        return;
    }

    fetch('https://script.google.com/macros/s/AKfycbyFm6Er8xxj2y06RE_Lp_THSTglpnOu3ZXtcxAdKoWnTljj3zTFYXiraTPbYZMnCIUe/exec', {
        method: 'POST',
        headers: {
            'Content-Type': 'application/json'
        },
        body: JSON.stringify(objections)
    })
    .then(response => response.json())
    .then(result => {
        alert("이의제기가 정상적으로 제출되었습니다!");
        document.getElementById('result').innerHTML = ""; // 제출 후 결과창 비우기
    })
    .catch(error => {
        console.error("이의제기 제출 실패:", error);
        alert("제출 중 오류가 발생했습니다. 다시 시도해주세요.");
    });
}
</script>

</body>
</html>
